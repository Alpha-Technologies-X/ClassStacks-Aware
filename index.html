<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/ClassStacks-Aware/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassStacks Aware - Enhanced Monitoring Dashboard</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #e63946;
            --success: #2a9d8f;
            --warning: #f4a261;
            --dark: #212529;
            --light: #f8f9fa;
            --sidebar: #2c3e50;
            --sidebar-hover: #34495e;
            --aware-primary: #6a11cb;
            --aware-secondary: #2575fc;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-round: 50px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fb;
            color: var(--dark);
            overflow: hidden;
        }
        
        /* Authentication Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            padding: 20px;
        }
        
        .auth-box {
            background: white;
            padding: 40px;
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo h1 {
            color: var(--aware-primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        }
        
        .auth-tab.active {
            color: var(--aware-primary);
            border-bottom-color: var(--aware-primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5ee;
            border-radius: var(--radius-md);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--aware-primary);
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #e63946 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #2a9d8f 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #f4a261 100%);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            color: var(--aware-primary);
            border: 2px solid var(--aware-primary);
            border-radius: var(--radius-md);
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: #ffeaea;
            border-radius: var(--radius-md);
            display: none;
        }
        
        .success-message {
            color: var(--success);
            text-align: center;
            margin-top: 15px;
            padding: 12px;
            background: #e8f5e8;
            border-radius: var(--radius-md);
            display: none;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .auth-toggle a {
            color: var(--aware-primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: none;
            flex-direction: column;
            height: 100vh;
        }
        
        .dashboard-header {
            background: white;
            padding: 0 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            z-index: 100;
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            color: white;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .dashboard-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            background: var(--sidebar);
            color: white;
            width: 250px;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: var(--radius-sm);
            margin: 0 10px;
        }
        
        .sidebar-item:hover {
            background: var(--sidebar-hover);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        /* Content Header */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .content-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: var(--radius-sm);
        }
        
        .btn-lg {
            padding: 16px 32px;
            font-size: 16px;
            border-radius: var(--radius-lg);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 6px solid var(--aware-primary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--aware-primary);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Content Cards */
        .content-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .content-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5ee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* Tabs for Class Management */
        .section-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .section-tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        }
        
        .section-tab:hover {
            color: var(--aware-primary);
            background: #f8f9fa;
        }
        
        .section-tab.active {
            color: var(--aware-primary);
            border-bottom-color: var(--aware-primary);
            background: #f8f9fa;
        }
        
        .section-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .section-content.active {
            display: block;
        }
        
        /* Bypass Codes Grid */
        .bypass-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .bypass-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid #e1e5ee;
            position: relative;
            overflow: hidden;
        }
        
        .bypass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success) 0%, #2a9d8f 100%);
        }
        
        .bypass-code {
            font-family: monospace;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--success);
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: #e8f5e8;
            border-radius: var(--radius-md);
            border: 2px dashed rgba(42, 157, 143, 0.3);
            letter-spacing: 2px;
        }
        
        /* Schedules Grid */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .schedule-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid #e1e5ee;
            position: relative;
            overflow: hidden;
        }
        
        .schedule-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
        }
        
        .schedule-days {
            display: flex;
            gap: 5px;
            margin: 15px 0;
        }
        
        .schedule-day {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            background: #f0f0f0;
            color: #666;
        }
        
        .schedule-day.active {
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            color: white;
        }
        
        .schedule-time {
            background: rgba(106, 17, 203, 0.1);
            padding: 10px 15px;
            border-radius: var(--radius-md);
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--aware-primary);
            display: inline-block;
            margin-top: 10px;
            border: 1px solid rgba(106, 17, 203, 0.2);
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: var(--radius-round);
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-active {
            background: #e7f7e9;
            color: var(--success);
        }
        
        .status-upcoming {
            background: #fff3cd;
            color: var(--warning);
        }
        
        .status-inactive {
            background: #f8f9fa;
            color: #666;
        }
        
        /* Class Cards */
        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .class-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid #e1e5ee;
            position: relative;
            overflow: hidden;
        }
        
        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .class-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .class-name {
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .class-code {
            font-family: monospace;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            border: 1px solid #e1e5ee;
        }
        
        .class-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: var(--radius-sm);
        }
        
        .class-stats {
            display: flex;
            gap: 15px;
        }
        
        .class-stat {
            text-align: center;
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: var(--radius-md);
            border: 1px solid #e1e5ee;
        }
        
        .class-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--aware-primary);
        }
        
        .class-stat-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        .class-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        /* Activity Timeline */
        .activity-timeline {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .timeline-item {
            padding: 15px;
            border-bottom: 1px solid #e1e5ee;
            display: flex;
            align-items: center;
            gap: 15px;
            border-radius: var(--radius-sm);
            transition: all 0.3s;
        }
        
        .timeline-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }
        
        .timeline-item:last-child {
            border-bottom: none;
        }
        
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .timeline-desc {
            font-size: 0.9rem;
            color: #666;
        }
        
        .timeline-time {
            font-size: 0.8rem;
            color: #999;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: var(--radius-sm);
            border: 1px solid #e1e5ee;
        }
        
        /* Day Selection */
        .days-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .day-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #f0f0f0;
            color: #666;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .day-option:hover {
            background: #e1e5ee;
        }
        
        .day-option.selected {
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            color: white;
        }
        
        /* Time Input */
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-input-group input {
            flex: 1;
        }
        
        .time-input-group span {
            color: #666;
        }
        
        /* Role-based restrictions */
        .teacher-restricted {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }
        
        .teacher-restricted::after {
            content: "School Admin Only";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        .teacher-restricted:hover::after {
            opacity: 1;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e5ee;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .modal-close {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #e1e5ee;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: linear-gradient(135deg, var(--danger) 0%, #e63946 100%);
            color: white;
            border-color: var(--danger);
            transform: rotate(90deg);
        }
        
        /* Checkbox Styles */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: var(--radius-sm);
            background: #f8f9fa;
            border: 1px solid #e1e5ee;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid #ccc;
            cursor: pointer;
        }
        
        .checkbox-group input[type="checkbox"]:checked {
            background-color: var(--aware-primary);
            border-color: var(--aware-primary);
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-item span {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .class-grid, .bypass-grid, .schedule-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 20px;
                border-radius: var(--radius-lg);
            }
            
            .section-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .section-tab {
                white-space: nowrap;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: var(--radius-sm);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%);
            border-radius: var(--radius-sm);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--aware-secondary) 0%, var(--aware-primary) 100%);
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .aware-view {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(106, 17, 203, 0.3);
            border-radius: 50%;
            border-top-color: var(--aware-primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-logo">
                <h1>üîç ClassStacks Aware</h1>
                <p>Enhanced Monitoring Dashboard</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="schoolTab" onclick="showAuthTab('school')">School Admin</div>
                <div class="auth-tab" id="teacherTab" onclick="showAuthTab('teacher')">Teacher</div>
            </div>
            
            <!-- School Admin Login Form -->
            <div id="schoolAuth">
                <div class="form-group">
                    <label for="schoolEmail">Email Address</label>
                    <input type="email" id="schoolEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="schoolPassword">Password</label>
                    <input type="password" id="schoolPassword" placeholder="Enter your password" required>
                </div>
                
                <button class="btn btn-primary" onclick="loginSchool()" style="width: 100%;">Login as School Admin</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showSchoolRegistration()">Don't have an account? Register</a>
                </div>
            </div>
            
            <!-- School Registration Form -->
            <div id="schoolRegistration" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 20px;">Create School Account</h2>
                
                <div class="form-group">
                    <label for="schoolName">School Name</label>
                    <input type="text" id="schoolName" placeholder="Enter your school name" required>
                </div>
                
                <div class="form-group">
                    <label for="schoolType">School Type</label>
                    <select id="schoolType" required>
                        <option value="">Select school type</option>
                        <option value="elementary">Elementary School</option>
                        <option value="middle">Middle School</option>
                        <option value="high">High School</option>
                        <option value="college">College/University</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="adminName">Administrator Name</label>
                    <input type="text" id="adminName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="adminEmail">Email Address</label>
                    <input type="email" id="adminEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Create a password" required>
                </div>
                
                <button class="btn btn-success" onclick="registerSchool()" style="width: 100%;">Create School Account</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showSchoolLogin()">Already have an account? Login</a>
                </div>
            </div>
            
            <!-- Teacher Login Form -->
            <div id="teacherAuth" style="display: none;">
                <div class="form-group">
                    <label for="teacherEmail">Email Address</label>
                    <input type="email" id="teacherEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="teacherPassword">Password</label>
                    <input type="password" id="teacherPassword" placeholder="Enter your password" required>
                </div>
                
                <button class="btn btn-primary" onclick="loginTeacher()" style="width: 100%;">Login as Teacher</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showTeacherRegistration()">Don't have an account? Register</a>
                </div>
            </div>
            
            <!-- Teacher Registration Form -->
            <div id="teacherRegistration" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 20px;">Teacher Registration</h2>
                
                <div class="form-group">
                    <label for="teacherName">Full Name</label>
                    <input type="text" id="teacherName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="teacherRegEmail">Email Address</label>
                    <input type="email" id="teacherRegEmail" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="teacherRegPassword">Password</label>
                    <input type="password" id="teacherRegPassword" placeholder="Create a password" required>
                </div>
                
                <div class="form-group">
                    <label for="schoolNameTeacher">School Name</label>
                    <input type="text" id="schoolNameTeacher" placeholder="Enter your school name" required>
                </div>
                
                <button class="btn btn-success" onclick="registerTeacher()" style="width: 100%;">Create Teacher Account</button>
                
                <div class="auth-toggle">
                    <a href="#" onclick="showTeacherLogin()">Already have an account? Login</a>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </div>
    </div>

    <!-- ClassStacks Aware Dashboard -->
    <div class="dashboard" id="awareDashboard">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo">üîç ClassStacks Aware</div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div style="font-weight: 600;" id="userName">User</div>
                        <div style="font-size: 0.8rem; opacity: 0.8;" id="userRole">Dashboard</div>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>
        </div>
        
        <div class="dashboard-body">
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li class="sidebar-item active" onclick="showAwareView('overview')">
                        <span>üìä</span> <span>Overview</span>
                    </li>
                    <li class="sidebar-item" onclick="showAwareView('monitoring')">
                        <span>üëÅÔ∏è</span> <span>Real-time Monitoring</span>
                    </li>
                    <li class="sidebar-item" onclick="showAwareView('students')">
                        <span>üë®‚Äçüéì</span> <span>Student Management</span>
                    </li>
                    <li class="sidebar-item" onclick="showAwareView('classes')">
                        <span>üë®‚Äçüè´</span> <span>Class Management</span>
                    </li>
                    <li class="sidebar-item" onclick="showAwareView('activity')">
                        <span>üìà</span> <span>Activity Timeline</span>
                    </li>
                    <li class="sidebar-item" onclick="openClassStacksDashboard()">
                        <span>üè´</span> <span>ClassStacks Dashboard</span>
                    </li>
                </ul>
            </div>
            
            <div class="main-content">
                <!-- Overview View -->
                <div class="aware-view" id="overviewView">
                    <div class="content-header">
                        <div class="content-title">Monitoring Dashboard Overview</div>
                        <button class="btn btn-primary" onclick="startClassSession()">
                            <span>‚ñ∂Ô∏è</span> Start Monitoring Session
                        </button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="awareStudents">0</div>
                            <div class="stat-label">Connected Students</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="awareActive">0</div>
                            <div class="stat-label">Active Now</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="awareClasses">0</div>
                            <div class="stat-label">Active Classes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="awareBlocked">0</div>
                            <div class="stat-label">Blocked Attempts</div>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <div class="card-header">
                            <div class="card-title">Recent Student Activity</div>
                            <button class="btn btn-outline" onclick="showAwareView('activity')">View All</button>
                        </div>
                        <div class="card-body">
                            <div class="activity-timeline" id="recentActivity">
                                <!-- Recent activity will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title">Top Websites</div>
                            </div>
                            <div class="card-body">
                                <div id="topWebsites">
                                    <!-- Top websites will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title">Active Classes</div>
                            </div>
                            <div class="card-body">
                                <div id="activeClasses">
                                    <!-- Active classes will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Real-time Monitoring View -->
                <div class="aware-view" id="monitoringView" style="display: none;">
                    <div class="content-header">
                        <div class="content-title">Real-time Student Monitoring</div>
                        <div>
                            <button class="btn btn-warning" onclick="takeAllScreenshots()">
                                <span>üì∏</span> Take All Screenshots
                            </button>
                            <button class="btn btn-danger" onclick="lockAllStudents()">
                                <span>üîí</span> Lock All
                            </button>
                            <button class="btn btn-success" onclick="unlockAllStudents()">
                                <span>üîì</span> Unlock All
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <div class="card-header">
                            <div class="card-title">Student Activity</div>
                            <div>
                                <select id="classFilter" onchange="filterStudentsByClass()" class="form-control" style="width: 200px;">
                                    <option value="">All Classes</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="monitoringStudents">
                                <!-- Student monitoring will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Student Management View -->
                <div class="aware-view" id="studentsView" style="display: none;">
                    <div class="content-header">
                        <div class="content-title">Student Management</div>
                        <button class="btn btn-primary" onclick="showAddStudentModal()">
                            <span>‚ûï</span> Add Student
                        </button>
                    </div>
                    
                    <div class="content-card">
                        <div class="card-header">
                            <div class="card-title">All Students</div>
                            <div>
                                <input type="text" id="studentSearch" placeholder="Search students..." class="form-control" style="width: 200px;">
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="studentsTableContainer">
                                <!-- Students table will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Class Management View -->
                <div class="aware-view" id="classesView" style="display: none;">
                    <div class="content-header">
                        <div class="content-title">Class Management</div>
                        <div>
                            <button class="btn btn-warning" onclick="showCreateBypassCodeModal()" style="margin-right: 10px;">
                                <span>üîë</span> Create Bypass Code
                            </button>
                            <button class="btn btn-success" onclick="showCreateScheduleModal()" style="margin-right: 10px;">
                                <span>üìÖ</span> Create Schedule
                            </button>
                            <button class="btn btn-primary" onclick="showCreateClassModal()">
                                <span>‚ûï</span> Create Class
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tabs for Class Management -->
                    <div class="section-tabs">
                        <div class="section-tab active" onclick="showClassSection('classes')">Classes</div>
                        <div class="section-tab" onclick="showClassSection('schedules')">Class Schedules</div>
                        <div class="section-tab" onclick="showClassSection('bypass')">Bypass Codes</div>
                        <div class="section-tab" onclick="showClassSection('settings')">Settings</div>
                    </div>
                    
                    <!-- Classes Section -->
                    <div class="section-content active" id="classesSection">
                        <div class="class-grid" id="classesGrid">
                            <!-- Classes will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Schedules Section -->
                    <div class="section-content" id="schedulesSection">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title">Class Schedules</div>
                                <button class="btn btn-primary" onclick="showCreateScheduleModal()">
                                    <span>‚ûï</span> Create Schedule
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="schedule-grid" id="schedulesGrid">
                                    <!-- Schedules will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bypass Codes Section -->
                    <div class="section-content" id="bypassSection">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title">Bypass Codes</div>
                                <button class="btn btn-primary" onclick="showCreateBypassCodeModal()">
                                    <span>‚ûï</span> Generate New Code
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="bypass-grid" id="bypassCodesGrid">
                                    <!-- Bypass codes will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="section-content" id="settingsSection">
                        <div class="content-card">
                            <div class="card-header">
                                <div class="card-title">Monitoring Settings</div>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="globalBlocks">Globally Blocked Websites (one per line)</label>
                                    <textarea id="globalBlocks" rows="6" placeholder="Enter websites to block for all students" class="form-control"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="monitoringHours">Monitoring Hours</label>
                                    <div class="time-input-group">
                                        <input type="time" id="monitoringStart" class="form-control" value="08:00">
                                        <span>to</span>
                                        <input type="time" id="monitoringEnd" class="form-control" value="16:00">
                                    </div>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableScreenshots" checked>
                                    <label for="enableScreenshots">Enable screenshot capture</label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableActivityLogging" checked>
                                    <label for="enableActivityLogging">Enable activity logging</label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="enableMessaging" checked>
                                    <label for="enableMessaging">Enable student messaging</label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <input type="checkbox" id="requireParentApproval">
                                    <label for="requireParentApproval">Require parent approval for student access</label>
                                </div>
                                
                                <button class="btn btn-primary" onclick="saveSchoolSettings()" style="width: 100%; margin-top: 20px;">
                                    <span>üíæ</span> Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Timeline View -->
                <div class="aware-view" id="activityView" style="display: none;">
                    <div class="content-header">
                        <div class="content-title">Activity Timeline</div>
                        <div>
                            <select id="activityFilter" onchange="filterActivity()" class="form-control" style="width: 200px; margin-right: 10px;">
                                <option value="all">All Activity</option>
                                <option value="website">Website Visits</option>
                                <option value="message">Messages</option>
                                <option value="blocked">Blocked Attempts</option>
                            </select>
                            <button class="btn btn-primary" onclick="exportActivity()">
                                <span>üì§</span> Export Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-card">
                        <div class="card-body">
                            <div class="activity-timeline" id="fullActivityTimeline">
                                <!-- Full activity timeline will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="studentDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Student Details</div>
                <button class="modal-close" onclick="closeModal('studentDetailModal')">√ó</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--aware-primary) 0%, var(--aware-secondary) 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 15px;" id="studentDetailAvatar">üë®‚Äçüéì</div>
                <h3 id="studentDetailName">Student Name</h3>
                <p id="studentDetailClass">Class: Unknown</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px; border-radius: var(--radius-md); border: 1px solid #e1e5ee;">
                    <div style="font-weight: 600; margin-bottom: 5px; color: var(--aware-primary);">Current Activity</div>
                    <div id="studentCurrentActivity">No activity</div>
                </div>
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 15px; border-radius: var(--radius-md); border: 1px solid #e1e5ee;">
                    <div style="font-weight: 600; margin-bottom: 5px; color: var(--aware-primary);">Status</div>
                    <div id="studentCurrentStatus">Offline</div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px;">Recent Activity</h4>
                <div id="studentActivityList" style="max-height: 200px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: var(--radius-md);">
                    <!-- Student activity list will be populated here -->
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="sendStudentMessage()" style="flex: 1;">
                    <span>üí¨</span> Send Message
                </button>
                <button class="btn btn-warning" onclick="lockStudentBrowser()" style="flex: 1;">
                    <span>üîí</span> Lock Browser
                </button>
                <button class="btn btn-success" onclick="requestScreenshot()" style="flex: 1;">
                    <span>üì∏</span> Request Screenshot
                </button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="createClassModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create New Class</div>
                <button class="modal-close" onclick="closeModal('createClassModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="awareClassName">Class Name</label>
                <input type="text" id="awareClassName" placeholder="e.g., Math Grade 5" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="awareClassSubject">Subject</label>
                <input type="text" id="awareClassSubject" placeholder="e.g., Mathematics" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="awareClassGrade">Grade Level</label>
                <input type="text" id="awareClassGrade" placeholder="e.g., Grade 5" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="awareClassBlocks">Blocked Websites (one per line)</label>
                <textarea id="awareClassBlocks" rows="4" placeholder="Add websites to block for this class" class="form-control"></textarea>
            </div>
            
            <div class="form-group">
                <label for="awareClassTeacher">Teacher Name</label>
                <input type="text" id="awareClassTeacher" placeholder="e.g., Mr. Johnson" class="form-control">
            </div>
            
            <button class="btn btn-primary" onclick="createAwareClass()" style="width: 100%; padding: 14px;">
                <span>‚ûï</span> Create Class
            </button>
        </div>
    </div>
    
    <div class="modal" id="addStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Student to Class</div>
                <button class="modal-close" onclick="closeModal('addStudentModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="awareStudentFirstName">First Name</label>
                <input type="text" id="awareStudentFirstName" placeholder="Enter student first name" required class="form-control">
            </div>
            
            <div class="form-group">
                <label for="awareStudentLastName">Last Name</label>
                <input type="text" id="awareStudentLastName" placeholder="Enter student last name" required class="form-control">
            </div>
            
            <div class="form-group">
                <label for="awareStudentClassSelect">Select Class</label>
                <select id="awareStudentClassSelect" class="form-control">
                    <!-- Classes will be populated here -->
                </select>
            </div>
            
            <button class="btn btn-primary" onclick="addStudentToAwareClass()" style="width: 100%; padding: 14px;">
                <span>‚ûï</span> Add Student
            </button>
        </div>
    </div>

    <!-- NEW MODALS FOR BYPASS CODES AND SCHEDULES -->
    
    <div class="modal" id="createBypassCodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Bypass Code</div>
                <button class="modal-close" onclick="closeModal('createBypassCodeModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="bypassCodeType">Code Type</label>
                <select id="bypassCodeType" class="form-control">
                    <option value="student">Student Access Code</option>
                    <option value="parent">Parent Override Code</option>
                    <option value="emergency">Emergency Access Code</option>
                    <option value="teacher">Teacher Override Code</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="bypassCodeFor">Code For (Optional)</label>
                <select id="bypassCodeFor" class="form-control">
                    <option value="">All Students/Classes</option>
                    <option value="class">Specific Class</option>
                    <option value="student">Specific Student</option>
                </select>
            </div>
            
            <div id="bypassCodeClassSelect" style="display: none;">
                <div class="form-group">
                    <label for="bypassClassSelect">Select Class</label>
                    <select id="bypassClassSelect" class="form-control">
                        <!-- Classes will be populated here -->
                    </select>
                </div>
            </div>
            
            <div id="bypassCodeStudentSelect" style="display: none;">
                <div class="form-group">
                    <label for="bypassStudentSelect">Select Student</label>
                    <select id="bypassStudentSelect" class="form-control">
                        <!-- Students will be populated here -->
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="bypassExpiry">Expiry Time</label>
                <select id="bypassExpiry" class="form-control">
                    <option value="1h">1 Hour</option>
                    <option value="4h">4 Hours</option>
                    <option value="24h">24 Hours</option>
                    <option value="7d">7 Days</option>
                    <option value="30d">30 Days</option>
                    <option value="never" selected>Never (Until Revoked)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="bypassUsageLimit">Usage Limit (0 = unlimited)</label>
                <input type="number" id="bypassUsageLimit" class="form-control" value="1" min="0">
            </div>
            
            <div class="form-group">
                <label for="bypassNotes">Notes (Optional)</label>
                <input type="text" id="bypassNotes" class="form-control" placeholder="e.g., For field trip access">
            </div>
            
            <button class="btn btn-primary" onclick="createBypassCode()" style="width: 100%; padding: 14px;">
                <span>üîë</span> Generate Bypass Code
            </button>
        </div>
    </div>
    
    <div class="modal" id="createScheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Class Schedule</div>
                <button class="modal-close" onclick="closeModal('createScheduleModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="scheduleClassSelect">Select Class</label>
                <select id="scheduleClassSelect" class="form-control">
                    <!-- Classes will be populated here -->
                </select>
            </div>
            
            <div class="form-group">
                <label>Schedule Days</label>
                <div class="days-selector">
                    <div class="day-option" data-day="mon" onclick="toggleDaySelection(this)">Mon</div>
                    <div class="day-option" data-day="tue" onclick="toggleDaySelection(this)">Tue</div>
                    <div class="day-option" data-day="wed" onclick="toggleDaySelection(this)">Wed</div>
                    <div class="day-option" data-day="thu" onclick="toggleDaySelection(this)">Thu</div>
                    <div class="day-option" data-day="fri" onclick="toggleDaySelection(this)">Fri</div>
                    <div class="day-option" data-day="sat" onclick="toggleDaySelection(this)">Sat</div>
                    <div class="day-option" data-day="sun" onclick="toggleDaySelection(this)">Sun</div>
                </div>
                <input type="hidden" id="scheduleDays">
            </div>
            
            <div class="form-group">
                <label>Schedule Time</label>
                <div class="time-input-group">
                    <input type="time" id="scheduleStartTime" class="form-control" value="09:00">
                    <span>to</span>
                    <input type="time" id="scheduleEndTime" class="form-control" value="10:00">
                </div>
            </div>
            
            <div class="form-group">
                <label for="scheduleType">Schedule Type</label>
                <select id="scheduleType" class="form-control">
                    <option value="monitoring">Monitoring Session (Block all non-educational sites)</option>
                    <option value="open">Open Access (Allow all websites)</option>
                    <option value="restricted">Restricted (Use class blocked sites list)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="scheduleStartDate">Start Date</label>
                <input type="date" id="scheduleStartDate" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="scheduleEndDate">End Date (Optional)</label>
                <input type="date" id="scheduleEndDate" class="form-control">
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="scheduleActive" checked>
                <label for="scheduleActive">Schedule Active</label>
            </div>
            
            <button class="btn btn-primary" onclick="createClassSchedule()" style="width: 100%; padding: 14px;">
                <span>‚ûï</span> Create Schedule
            </button>
        </div>
    </div>
    
    <div class="modal" id="viewScheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Schedule Details</div>
                <button class="modal-close" onclick="closeModal('viewScheduleModal')">√ó</button>
            </div>
            
            <div id="scheduleDetails">
                <!-- Schedule details will be populated here -->
            </div>
        </div>
    </div>

<script>
    // Global variables
    let currentUser = null;
    let currentView = 'overview';
    let currentClassSection = 'classes';
    let monitoringInterval;
    let selectedStudent = null;
    let selectedDays = [];
    
    // Initialize the application
    function initializeApp() {
        // Check if user is already logged in
        const savedUser = localStorage.getItem('currentUser');
        
        if (savedUser) {
            try {
                currentUser = JSON.parse(savedUser);
                
                // Both school admins AND teachers can access Aware dashboard
                if (currentUser.role === 'school' || currentUser.role === 'teacher') {
                    showAwareDashboard();
                } else {
                    // Show login page
                    showAuthTab('school');
                }
            } catch (e) {
                console.error('Error parsing user data:', e);
                showAuthTab('school');
            }
        } else {
            // No user logged in, show login page
            showAuthTab('school');
        }
        
        // Initialize data structure if it doesn't exist
        initializeData();
    }
    
    // Initialize data structure - MATCHES MAIN DASHBOARD
    function initializeData() {
        const data = getSharedData();
        
        // Ensure all required structures exist
        if (!data.awareSettings) {
            data.awareSettings = {
                globalBlocks: ['youtube.com', 'facebook.com', 'instagram.com', 'tiktok.com', 'games.com'],
                monitoringHours: { start: '08:00', end: '16:00' },
                enableScreenshots: true,
                enableActivityLogging: true,
                enableMessaging: true,
                requireParentApproval: false
            };
        }
        
        // Ensure activity logs exist
        if (!data.activityLogs) data.activityLogs = {};
        
        // Ensure student locks exist
        if (!data.studentLocks) data.studentLocks = {};
        
        // Ensure teacher control exists
        if (!data.teacherControl) data.teacherControl = {};
        
        // Ensure messages exist
        if (!data.messages) data.messages = {};
        
        // Ensure screenshots exist
        if (!data.screenshots) data.screenshots = {};
        
        saveSharedData(data);
    }
    
    // Get shared data - MATCHES OTHER COMPONENTS
    function getSharedData() {
        const defaultData = {
            schools: {},
            teachers: {},
            parents: {},
            classes: {},
            students: {},
            parentCodes: {},
            bypassCodes: {},
            schedules: {},
            schoolSettings: {},
            activityLogs: {},
            awareSettings: {},
            chatMessages: {},
            whiteboardData: {},
            teacherControl: {},
            studentLocks: {},
            screenshots: {},
            connectionCodes: {},
            lastUpdated: Date.now()
        };
        
        try {
            const stored = localStorage.getItem('classStacksData');
            if (stored) {
                const parsed = JSON.parse(stored);
                return {...defaultData, ...parsed};
            }
        } catch (e) {
            console.error('Error parsing stored data:', e);
        }
        
        return defaultData;
    }
    
    // Save shared data
    function saveSharedData(data) {
        data.lastUpdated = Date.now();
        localStorage.setItem('classStacksData', JSON.stringify(data));
    }
    
    // Show authentication tab
    function showAuthTab(tab) {
        document.getElementById('schoolTab').classList.remove('active');
        document.getElementById('teacherTab').classList.remove('active');
        
        document.getElementById('schoolAuth').style.display = 'none';
        document.getElementById('schoolRegistration').style.display = 'none';
        document.getElementById('teacherAuth').style.display = 'none';
        document.getElementById('teacherRegistration').style.display = 'none';
        
        if (tab === 'school') {
            document.getElementById('schoolTab').classList.add('active');
            document.getElementById('schoolAuth').style.display = 'block';
        } else if (tab === 'teacher') {
            document.getElementById('teacherTab').classList.add('active');
            document.getElementById('teacherAuth').style.display = 'block';
        }
    }
    
    // Show school registration
    function showSchoolRegistration() {
        document.getElementById('schoolAuth').style.display = 'none';
        document.getElementById('schoolRegistration').style.display = 'block';
    }
    
    // Show school login
    function showSchoolLogin() {
        document.getElementById('schoolRegistration').style.display = 'none';
        document.getElementById('schoolAuth').style.display = 'block';
    }
    
    // Show teacher registration
    function showTeacherRegistration() {
        document.getElementById('teacherAuth').style.display = 'none';
        document.getElementById('teacherRegistration').style.display = 'block';
    }
    
    // Show teacher login
    function showTeacherLogin() {
        document.getElementById('teacherRegistration').style.display = 'none';
        document.getElementById('teacherAuth').style.display = 'block';
    }
    
    // Generate school code - MATCHES MAIN DASHBOARD
    function generateSchoolCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 6; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
    }
    
    // Show error message
    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }
    
    // Show success message
    function showSuccess(message) {
        const successDiv = document.getElementById('successMessage');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        setTimeout(() => {
            successDiv.style.display = 'none';
        }, 5000);
    }
    
    // Register a new school - MATCHES MAIN DASHBOARD
    function registerSchool() {
        const schoolName = document.getElementById('schoolName').value;
        const schoolType = document.getElementById('schoolType').value;
        const adminName = document.getElementById('adminName').value;
        const adminEmail = document.getElementById('adminEmail').value;
        const adminPassword = document.getElementById('adminPassword').value;
        
        if (!schoolName || !schoolType || !adminName || !adminEmail || !adminPassword) {
            showError('Please fill in all required fields');
            return;
        }
        
        if (adminPassword.length < 6) {
            showError('Password must be at least 6 characters long');
            return;
        }
        
        const data = getSharedData();
        
        // Check if email already exists
        const existingUser = Object.values(data.schools).find(school => 
            school.email === adminEmail
        );
        
        if (existingUser) {
            showError('A school with this email already exists');
            return;
        }
        
        // Create school account
        const schoolId = 'school_' + Date.now();
        const schoolCode = generateSchoolCode();
        
        data.schools[schoolId] = {
            id: schoolId,
            name: schoolName,
            type: schoolType,
            adminName: adminName,
            email: adminEmail,
            password: adminPassword,
            role: 'school',
            schoolCode: schoolCode,
            created: Date.now()
        };
        
        // Initialize school settings
        data.schoolSettings[schoolId] = {
            blockedSites: ['youtube.com', 'facebook.com', 'instagram.com', 'tiktok.com'],
            allowBrowsing: true,
            requireStudentNames: true,
            enableScreenshots: true
        };
        
        // Initialize aware settings
        data.awareSettings = {
            globalBlocks: ['youtube.com', 'facebook.com', 'instagram.com', 'tiktok.com', 'games.com'],
            monitoringHours: { start: '08:00', end: '16:00' },
            enableScreenshots: true,
            enableActivityLogging: true,
            enableMessaging: true,
            requireParentApproval: false
        };
        
        // Save data
        saveSharedData(data);
        
        // Set current user
        currentUser = data.schools[schoolId];
        
        // Save to localStorage
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Show success message and dashboard
        showSuccess('School account created successfully! School Code: ' + schoolCode);
        setTimeout(() => {
            showAwareDashboard();
        }, 1500);
    }
    
    // Login as school admin - MATCHES MAIN DASHBOARD
    function loginSchool() {
        const email = document.getElementById('schoolEmail').value;
        const password = document.getElementById('schoolPassword').value;
        
        if (!email || !password) {
            showError('Please enter both email and password');
            return;
        }
        
        const data = getSharedData();
        
        // Find school with matching credentials
        const school = Object.values(data.schools).find(s => 
            s.email === email && s.password === password
        );
        
        if (school) {
            currentUser = school;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showAwareDashboard();
        } else {
            showError('Invalid email or password');
        }
    }
    
    // Register a new teacher - MATCHES MAIN DASHBOARD
    function registerTeacher() {
        const teacherName = document.getElementById('teacherName').value;
        const teacherEmail = document.getElementById('teacherRegEmail').value;
        const teacherPassword = document.getElementById('teacherRegPassword').value;
        const schoolName = document.getElementById('schoolNameTeacher').value;
        
        if (!teacherName || !teacherEmail || !teacherPassword || !schoolName) {
            showError('Please fill in all required fields');
            return;
        }
        
        if (teacherPassword.length < 6) {
            showError('Password must be at least 6 characters long');
            return;
        }
        
        const data = getSharedData();
        
        // Check if email already exists
        const existingUser = Object.values(data.teachers).find(teacher => 
            teacher.email === teacherEmail
        );
        
        if (existingUser) {
            showError('A teacher with this email already exists');
            return;
        }
        
        // Create teacher account
        const teacherId = 'teacher_' + Date.now();
        data.teachers[teacherId] = {
            id: teacherId,
            name: teacherName,
            email: teacherEmail,
            password: teacherPassword,
            school: schoolName,
            role: 'teacher',
            created: Date.now()
        };
        
        // Save data
        saveSharedData(data);
        
        // Set current user
        currentUser = data.teachers[teacherId];
        
        // Save to localStorage
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Show success message and dashboard
        showSuccess('Teacher account created successfully!');
        setTimeout(() => {
            showAwareDashboard();
        }, 1500);
    }
    
    // Login as teacher - MATCHES MAIN DASHBOARD
    function loginTeacher() {
        const email = document.getElementById('teacherEmail').value;
        const password = document.getElementById('teacherPassword').value;
        
        if (!email || !password) {
            showError('Please enter both email and password');
            return;
        }
        
        const data = getSharedData();
        
        // Find teacher with matching credentials
        const teacher = Object.values(data.teachers).find(t => 
            t.email === email && t.password === password
        );
        
        if (teacher) {
            currentUser = teacher;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showAwareDashboard();
        } else {
            showError('Invalid email or password');
        }
    }
    
    // Show Aware dashboard
    function showAwareDashboard() {
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('awareDashboard').style.display = 'flex';
        
        // Update user info
        document.getElementById('userName').textContent = currentUser.name || currentUser.adminName;
        document.getElementById('userAvatar').textContent = (currentUser.name || currentUser.adminName).charAt(0).toUpperCase();
        document.getElementById('userRole').textContent = currentUser.role === 'school' ? 'School Admin' : 'Teacher';
        
        // Apply role-based restrictions
        applyRoleRestrictions();
        
        // Start monitoring
        startMonitoring();
        
        // Update dashboard
        updateAwareDashboard();
    }
    
    // Apply role-based restrictions
    function applyRoleRestrictions() {
        const isTeacher = currentUser.role === 'teacher';
        
        // Teacher can only create classes for themselves
        if (isTeacher) {
            // Add teacher restriction indicator to certain elements
            const adminOnlyButtons = document.querySelectorAll('.btn-warning, .btn-success');
            adminOnlyButtons.forEach(btn => {
                if (btn.textContent.includes('Bypass') || btn.textContent.includes('Schedule')) {
                    btn.classList.add('teacher-restricted');
                    btn.onclick = function() {
                        alert('This feature is only available to School Administrators');
                    };
                }
            });
        }
    }
    
    // Show aware view
    function showAwareView(view) {
        currentView = view;
        
        // Update sidebar active item
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Find and activate the correct sidebar item
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        for (let i = 0; i < sidebarItems.length; i++) {
            if (sidebarItems[i].textContent.includes(getViewName(view))) {
                sidebarItems[i].classList.add('active');
                break;
            }
        }
        
        document.querySelectorAll('.aware-view').forEach(view => {
            view.style.display = 'none';
        });
        
        document.getElementById(view + 'View').style.display = 'block';
        
        // Update the view
        updateAwareView();
    }
    
    // Get view name from ID
    function getViewName(viewId) {
        const viewNames = {
            'overview': 'Overview',
            'monitoring': 'Real-time Monitoring',
            'students': 'Student Management',
            'classes': 'Class Management',
            'activity': 'Activity Timeline'
        };
        return viewNames[viewId] || viewId;
    }
    
    // Update aware view
    function updateAwareView() {
        switch(currentView) {
            case 'overview':
                updateOverview();
                break;
            case 'monitoring':
                updateMonitoring();
                break;
            case 'students':
                updateStudents();
                break;
            case 'classes':
                updateClasses();
                break;
            case 'activity':
                updateActivity();
                break;
        }
    }
    
    // Update overview
    function updateOverview() {
        const data = getSharedData();
        
        // Get statistics
        const totalStudents = Object.values(data.students).length;
        const activeStudents = getActiveStudentsCount(data);
        const activeClasses = Object.values(data.classes).filter(c => c.active !== false).length;
        const blockedAttempts = getBlockedAttemptsCount(data);
        
        // Update stats
        document.getElementById('awareStudents').textContent = totalStudents;
        document.getElementById('awareActive').textContent = activeStudents;
        document.getElementById('awareClasses').textContent = activeClasses;
        document.getElementById('awareBlocked').textContent = blockedAttempts;
        
        // Update recent activity
        updateRecentActivity();
        
        // Update top websites
        updateTopWebsites();
        
        // Update active classes
        updateActiveClasses();
    }
    
    // Get count of active students (online in last 30 seconds)
    function getActiveStudentsCount(data) {
        const now = Date.now();
        return Object.values(data.students || {}).filter(s => 
            s.lastActive && (now - s.lastActive) < 30000
        ).length;
    }
    
    // Get count of blocked attempts
    function getBlockedAttemptsCount(data) {
        let count = 0;
        Object.values(data.activityLogs || {}).forEach(logs => {
            if (Array.isArray(logs)) {
                logs.forEach(log => {
                    if (log.action && log.action.includes('Blocked')) {
                        count++;
                    }
                });
            }
        });
        return count;
    }
    
    // Update recent activity
    function updateRecentActivity() {
        const data = getSharedData();
        const activities = getAllActivities(data).sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);
        
        const container = document.getElementById('recentActivity');
        container.innerHTML = '';
        
        activities.forEach(activity => {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            
            let icon = 'üìä';
            if (activity.action && activity.action.includes('Visited')) icon = 'üåê';
            else if (activity.action && activity.action.includes('Message')) icon = 'üí¨';
            else if (activity.action && activity.action.includes('Blocked')) icon = 'üö´';
            
            item.innerHTML = `
                <div class="timeline-icon">${icon}</div>
                <div class="timeline-content">
                    <div class="timeline-title">${activity.action || 'Activity'}</div>
                    <div class="timeline-desc">${getStudentNameById(activity.studentId) || ''}</div>
                </div>
                <div class="timeline-time">${formatTime(activity.timestamp)}</div>
            `;
            container.appendChild(item);
        });
    }
    
    // Get all activities from all students
    function getAllActivities(data) {
        const allActivities = [];
        Object.entries(data.activityLogs || {}).forEach(([studentId, logs]) => {
            if (Array.isArray(logs)) {
                logs.forEach(log => {
                    allActivities.push({
                        ...log,
                        studentId: studentId
                    });
                });
            }
        });
        return allActivities;
    }
    
    // Update top websites
    function updateTopWebsites() {
        const data = getSharedData();
        const websiteCounts = {};
        
        getAllActivities(data).forEach(activity => {
            if (activity.action && activity.action.includes('Visited')) {
                const match = activity.action.match(/Visited.*\((https?:\/\/[^)]+)\)/);
                if (match) {
                    const url = match[1];
                    const domain = url.replace('https://', '').replace('http://', '').split('/')[0];
                    websiteCounts[domain] = (websiteCounts[domain] || 0) + 1;
                }
            }
        });
        
        const topWebsites = Object.entries(websiteCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5);
        
        const container = document.getElementById('topWebsites');
        container.innerHTML = '';
        
        topWebsites.forEach(([website, count]) => {
            const div = document.createElement('div');
            div.className = 'timeline-item';
            div.innerHTML = `
                <div class="timeline-icon">üåê</div>
                <div class="timeline-content">
                    <div class="timeline-title">${website}</div>
                    <div class="timeline-desc">Visited ${count} times</div>
                </div>
            `;
            container.appendChild(div);
        });
    }
    
    // Update active classes
    function updateActiveClasses() {
        const data = getSharedData();
        const activeClasses = Object.values(data.classes || {}).filter(c => c.active !== false).slice(0, 3);
        
        const container = document.getElementById('activeClasses');
        container.innerHTML = '';
        
        activeClasses.forEach(cls => {
            const studentCount = Object.values(data.students || {}).filter(s => s.classCode === cls.id).length;
            const div = document.createElement('div');
            div.className = 'timeline-item';
            div.innerHTML = `
                <div class="timeline-icon">üë®‚Äçüè´</div>
                <div class="timeline-content">
                    <div class="timeline-title">${cls.name || cls.id}</div>
                    <div class="timeline-desc">${studentCount || 0} students ‚Ä¢ ${cls.teacher || 'No teacher'}</div>
                </div>
            `;
            container.appendChild(div);
        });
    }
    
    // Update monitoring view
    function updateMonitoring() {
        const data = getSharedData();
        
        // Update class filter
        const classFilter = document.getElementById('classFilter');
        classFilter.innerHTML = '<option value="">All Classes</option>';
        
        Object.values(data.classes || {}).forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.id;
            option.textContent = cls.name || cls.id;
            classFilter.appendChild(option);
        });
        
        // Update students
        updateMonitoringStudents();
    }
    
    // Update monitoring students
    function updateMonitoringStudents() {
        const data = getSharedData();
        const classFilter = document.getElementById('classFilter').value;
        
        let students = Object.values(data.students || {});
        
        // Filter by class if selected
        if (classFilter) {
            students = students.filter(s => s.classCode === classFilter);
        }
        
        const container = document.getElementById('monitoringStudents');
        container.innerHTML = '';
        
        students.forEach(student => {
            const isActive = student.lastActive && (Date.now() - student.lastActive) < 30000;
            const isLocked = data.studentLocks && data.studentLocks[student.id];
            
            // Get current tab info
            const currentTab = student.tabs && student.tabs[student.activeTab || 0];
            const activity = currentTab ? currentTab.title || currentTab.url : 'No activity';
            
            const card = document.createElement('div');
            card.className = 'class-card';
            card.style.cursor = 'pointer';
            card.onclick = () => showStudentDetail(student.id);
            
            card.innerHTML = `
                <div class="class-header">
                    <div class="class-name">${student.name || 'Unknown Student'}</div>
                    <div class="status-indicator ${isLocked ? 'status-locked' : (isActive ? 'status-active' : 'status-inactive')}">
                        ${isLocked ? 'üîí Locked' : (isActive ? '‚óè Active' : '‚óã Inactive')}
                    </div>
                </div>
                <div class="class-info">
                    <div>Class: ${getClassName(student.classCode) || 'Unknown'}</div>
                    <div>Activity: ${activity}</div>
                    <div>Last seen: ${student.lastActive ? formatTime(student.lastActive) : 'Never'}</div>
                </div>
                <div class="class-actions">
                    <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); requestScreenshot('${student.id}')">
                        <span>üì∏</span> Screenshot
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); lockStudent('${student.id}')">
                        <span>üîí</span> Lock
                    </button>
                    <button class="btn btn-sm btn-success" onclick="event.stopPropagation(); unlockStudent('${student.id}')">
                        <span>üîì</span> Unlock
                    </button>
                </div>
            `;
            container.appendChild(card);
        });
    }
    
    // Get class name by ID
    function getClassName(classId) {
        const data = getSharedData();
        const cls = data.classes && data.classes[classId];
        return cls ? cls.name : classId;
    }
    
    // Filter students by class
    function filterStudentsByClass() {
        updateMonitoringStudents();
    }
    
    // Update students view
    function updateStudents() {
        const data = getSharedData();
        const students = Object.values(data.students || {});
        
        const container = document.getElementById('studentsTableContainer');
        let html = `
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8f9fa; border-bottom: 2px solid #e1e5ee;">
                        <th style="padding: 12px; text-align: left;">Name</th>
                        <th style="padding: 12px; text-align: left;">Class</th>
                        <th style="padding: 12px; text-align: left;">Status</th>
                        <th style="padding: 12px; text-align: left;">Last Activity</th>
                        <th style="padding: 12px; text-align: left;">Actions</th>
                    </tr>
                </thead>
                <tbody>
        `;
        
        students.forEach(student => {
            const isActive = student.lastActive && (Date.now() - student.lastActive) < 30000;
            const isLocked = data.studentLocks && data.studentLocks[student.id];
            
            // Get current tab info
            const currentTab = student.tabs && student.tabs[student.activeTab || 0];
            const activity = currentTab ? currentTab.title || currentTab.url : 'No activity';
            
            html += `
                <tr style="border-bottom: 1px solid #e1e5ee;">
                    <td style="padding: 12px;">${student.name || 'Unknown'}</td>
                    <td style="padding: 12px;">${getClassName(student.classCode) || 'Unknown'}</td>
                    <td style="padding: 12px;">
                        <span class="status-indicator ${isLocked ? 'status-locked' : (isActive ? 'status-active' : 'status-inactive')}">
                            ${isLocked ? 'Locked' : (isActive ? 'Active' : 'Inactive')}
                        </span>
                    </td>
                    <td style="padding: 12px;">${activity}</td>
                    <td style="padding: 12px;">
                        <button class="btn btn-sm btn-primary" onclick="showStudentDetail('${student.id}')">View</button>
                        <button class="btn btn-sm btn-warning" onclick="editStudent('${student.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStudent('${student.id}')">Remove</button>
                    </td>
                </tr>
            `;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
    }
    
    // Update classes view
    function updateClasses() {
        updateClassSection();
    }
    
    // Show class section
    function showClassSection(section) {
        currentClassSection = section;
        
        // Update tabs
        document.querySelectorAll('.section-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.querySelectorAll('.section-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.getElementById(section + 'Section').classList.add('active');
        
        // Find and activate tab
        const tabs = document.querySelectorAll('.section-tab');
        for (let i = 0; i < tabs.length; i++) {
            if (tabs[i].textContent.includes(section.charAt(0).toUpperCase() + section.slice(1))) {
                tabs[i].classList.add('active');
                break;
            }
        }
        
        updateClassSection();
    }
    
    // Update class section
    function updateClassSection() {
        switch(currentClassSection) {
            case 'classes':
                updateClassesGrid();
                break;
            case 'schedules':
                updateSchedulesGrid();
                break;
            case 'bypass':
                updateBypassCodesGrid();
                break;
            case 'settings':
                updateSettings();
                break;
        }
    }
    
    // Update classes grid
    function updateClassesGrid() {
        const data = getSharedData();
        const classes = Object.values(data.classes || {});
        
        const container = document.getElementById('classesGrid');
        container.innerHTML = '';
        
        classes.forEach(cls => {
            const studentCount = Object.values(data.students || {}).filter(s => s.classCode === cls.id).length;
            const scheduleCount = Object.values(data.schedules || {}).filter(s => s.classId === cls.id).length;
            
            const card = document.createElement('div');
            card.className = 'class-card';
            
            card.innerHTML = `
                <div class="class-header">
                    <div class="class-name">${cls.name || cls.id}</div>
                    <div class="class-code">${cls.subject || 'No subject'}</div>
                </div>
                <div class="class-info">
                    <div>Grade: ${cls.grade || 'Not specified'}</div>
                    <div>Teacher: ${cls.teacher || 'Not assigned'}</div>
                    <div>Blocked sites: ${cls.blockedSites ? cls.blockedSites.length : 0}</div>
                </div>
                <div class="class-stats">
                    <div class="class-stat">
                        <div class="class-stat-value">${studentCount}</div>
                        <div class="class-stat-label">Students</div>
                    </div>
                    <div class="class-stat">
                        <div class="class-stat-value">${scheduleCount}</div>
                        <div class="class-stat-label">Schedules</div>
                    </div>
                    <div class="class-stat">
                        <div class="class-stat-value">${cls.active === false ? 'Inactive' : 'Active'}</div>
                        <div class="class-stat-label">Status</div>
                    </div>
                </div>
                <div class="class-actions">
                    <button class="btn btn-sm btn-primary" onclick="viewClassDetails('${cls.id}')">
                        <span>üëÅÔ∏è</span> View
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="editClass('${cls.id}')">
                        <span>‚úèÔ∏è</span> Edit
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteClass('${cls.id}')">
                        <span>üóëÔ∏è</span> Delete
                    </button>
                </div>
            `;
            container.appendChild(card);
        });
    }
    
    // Update schedules grid
    function updateSchedulesGrid() {
        const data = getSharedData();
        const schedules = Object.values(data.schedules || {});
        
        const container = document.getElementById('schedulesGrid');
        container.innerHTML = '';
        
        schedules.forEach(schedule => {
            const cls = data.classes && data.classes[schedule.classId];
            const card = document.createElement('div');
            card.className = 'schedule-card';
            card.onclick = () => viewScheduleDetails(schedule.id);
            
            const days = schedule.days || [];
            const dayNames = { mon: 'M', tue: 'T', wed: 'W', thu: 'T', fri: 'F', sat: 'S', sun: 'S' };
            
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0;">${cls ? cls.name : schedule.classId}</h4>
                    <span class="status-indicator ${schedule.active === false ? 'status-inactive' : 'status-active'}">
                        ${schedule.active === false ? 'Inactive' : 'Active'}
                    </span>
                </div>
                <div class="schedule-days">
                    ${Object.entries(dayNames).map(([day, letter]) => `
                        <div class="schedule-day ${days.includes(day) ? 'active' : ''}">${letter}</div>
                    `).join('')}
                </div>
                <div class="schedule-time">${schedule.startTime || '09:00'} - ${schedule.endTime || '10:00'}</div>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                    Type: ${schedule.type || 'monitoring'}
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); editSchedule('${schedule.id}')">
                        Edit
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteSchedule('${schedule.id}')">
                        Delete
                    </button>
                </div>
            `;
            container.appendChild(card);
        });
    }
    
    // Update bypass codes grid
    function updateBypassCodesGrid() {
        const data = getSharedData();
        const bypassCodes = Object.values(data.bypassCodes || {});
        
        const container = document.getElementById('bypassCodesGrid');
        container.innerHTML = '';
        
        bypassCodes.forEach(code => {
            const card = document.createElement('div');
            card.className = 'bypass-card';
            
            let typeLabel = code.type || 'Student';
            if (code.type === 'parent') typeLabel = 'Parent';
            else if (code.type === 'emergency') typeLabel = 'Emergency';
            else if (code.type === 'teacher') typeLabel = 'Teacher';
            
            const used = code.usageCount || 0;
            const limit = code.maxUsage || 0;
            const remaining = limit === 0 ? 'Unlimited' : limit - used;
            const isExpired = code.expiry && Date.now() > code.expiry;
            
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0;">${typeLabel} Code</h4>
                    <span class="status-indicator ${isExpired ? 'status-inactive' : 'status-active'}">
                        ${isExpired ? 'Expired' : 'Active'}
                    </span>
                </div>
                <div class="bypass-code">${code.code}</div>
                <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
                    ${code.notes || 'No description'}
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
                    <div>Used: ${used}/${limit === 0 ? '‚àû' : limit}</div>
                    <div>Expires: ${code.expiry ? formatDate(code.expiry) : 'Never'}</div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-sm btn-warning" onclick="copyBypassCode('${code.code}')">
                        Copy
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="revokeBypassCode('${code.id}')">
                        Revoke
                    </button>
                </div>
            `;
            container.appendChild(card);
        });
    }
    
    // Update settings
    function updateSettings() {
        const data = getSharedData();
        const settings = data.awareSettings || {};
        
        document.getElementById('globalBlocks').value = settings.globalBlocks ? settings.globalBlocks.join('\n') : '';
        document.getElementById('monitoringStart').value = settings.monitoringHours ? settings.monitoringHours.start : '08:00';
        document.getElementById('monitoringEnd').value = settings.monitoringHours ? settings.monitoringHours.end : '16:00';
        document.getElementById('enableScreenshots').checked = settings.enableScreenshots !== false;
        document.getElementById('enableActivityLogging').checked = settings.enableActivityLogging !== false;
        document.getElementById('enableMessaging').checked = settings.enableMessaging !== false;
        document.getElementById('requireParentApproval').checked = settings.requireParentApproval === true;
    }
    
    // Update activity view
    function updateActivity() {
        const data = getSharedData();
        const activities = getAllActivities(data).sort((a, b) => b.timestamp - a.timestamp);
        
        const container = document.getElementById('fullActivityTimeline');
        container.innerHTML = '';
        
        activities.forEach(activity => {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            
            let icon = 'üìä';
            if (activity.action && activity.action.includes('Visited')) icon = 'üåê';
            else if (activity.action && activity.action.includes('Message')) icon = 'üí¨';
            else if (activity.action && activity.action.includes('Blocked')) icon = 'üö´';
            else if (activity.action && activity.action.includes('connected')) icon = 'üîê';
            
            item.innerHTML = `
                <div class="timeline-icon">${icon}</div>
                <div class="timeline-content">
                    <div class="timeline-title">${activity.action || 'Activity'}</div>
                    <div class="timeline-desc">${getStudentNameById(activity.studentId) || 'Unknown student'}</div>
                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Class: ${getClassName(activity.classCode) || 'Unknown'}
                    </div>
                </div>
                <div class="timeline-time">${formatTime(activity.timestamp)}</div>
            `;
            container.appendChild(item);
        });
    }
    
    // Get student name by ID
    function getStudentNameById(studentId) {
        const data = getSharedData();
        const student = data.students && data.students[studentId];
        return student ? student.name : null;
    }
    
    // Start monitoring
    function startMonitoring() {
        // Clear any existing interval
        if (monitoringInterval) {
            clearInterval(monitoringInterval);
        }
        
        // Update dashboard every 3 seconds
        monitoringInterval = setInterval(() => {
            updateAwareDashboard();
        }, 3000);
        
        updateAwareDashboard();
    }
    
    // Update aware dashboard
    function updateAwareDashboard() {
        if (currentView === 'overview') {
            updateOverview();
        } else if (currentView === 'monitoring') {
            updateMonitoring();
        } else if (currentView === 'students') {
            updateStudents();
        } else if (currentView === 'classes') {
            updateClasses();
        } else if (currentView === 'activity') {
            updateActivity();
        }
    }
    
    // Start class session
    function startClassSession() {
        showSuccess('Starting monitoring session...');
        
        // Log activity
        logActivity('session_start', 'Monitoring session started', 'A new monitoring session has been initiated');
    }
    
    // Take all screenshots
    function takeAllScreenshots() {
        const data = getSharedData();
        const activeStudents = Object.values(data.students || {}).filter(s => 
            s.lastActive && (Date.now() - s.lastActive) < 30000
        );
        
        if (activeStudents.length === 0) {
            alert('No active students to capture');
            return;
        }
        
        showSuccess(`Taking screenshots of ${activeStudents.length} students...`);
        
        // Request screenshots for all active students
        activeStudents.forEach(student => {
            if (!data.screenshots) data.screenshots = {};
            data.screenshots[student.id] = {
                requested: true,
                timestamp: Date.now()
            };
        });
        
        saveSharedData(data);
        logActivity('screenshot_bulk', 'Bulk screenshot capture', `Requested screenshots from ${activeStudents.length} students`);
        
        // Simulate delay
        setTimeout(() => {
            showSuccess('Screenshots captured successfully!');
        }, 2000);
    }
    
    // Lock all students
    function lockAllStudents() {
        const data = getSharedData();
        const activeStudents = Object.values(data.students || {}).filter(s => 
            s.lastActive && (Date.now() - s.lastActive) < 30000
        );
        
        if (activeStudents.length === 0) {
            alert('No active students to lock');
            return;
        }
        
        if (confirm(`Lock browsers for ${activeStudents.length} students?`)) {
            activeStudents.forEach(student => {
                if (!data.studentLocks) data.studentLocks = {};
                data.studentLocks[student.id] = true;
            });
            
            saveSharedData(data);
            showSuccess(`Locked ${activeStudents.length} students' browsers`);
            logActivity('lock_all', 'Locked all students', 'All student browsers have been locked');
            updateAwareDashboard();
        }
    }
    
    // Unlock all students
    function unlockAllStudents() {
        const data = getSharedData();
        const lockedStudents = Object.values(data.students || {}).filter(s => 
            data.studentLocks && data.studentLocks[s.id]
        );
        
        if (lockedStudents.length === 0) {
            alert('No locked students to unlock');
            return;
        }
        
        lockedStudents.forEach(student => {
            if (data.studentLocks) {
                delete data.studentLocks[student.id];
            }
        });
        
        saveSharedData(data);
        showSuccess(`Unlocked ${lockedStudents.length} students' browsers`);
        logActivity('unlock_all', 'Unlocked all students', 'All student browsers have been unlocked');
        updateAwareDashboard();
    }
    
    // Show add student modal
    function showAddStudentModal() {
        const data = getSharedData();
        const classSelect = document.getElementById('awareStudentClassSelect');
        classSelect.innerHTML = '';
        
        Object.values(data.classes || {}).forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.id;
            option.textContent = cls.name || cls.id;
            classSelect.appendChild(option);
        });
        
        openModal('addStudentModal');
    }
    
    // Add student to aware class
    function addStudentToAwareClass() {
        const firstName = document.getElementById('awareStudentFirstName').value;
        const lastName = document.getElementById('awareStudentLastName').value;
        const classId = document.getElementById('awareStudentClassSelect').value;
        
        if (!firstName || !lastName || !classId) {
            showError('Please fill in all fields');
            return;
        }
        
        const data = getSharedData();
        const cls = data.classes && data.classes[classId];
        
        if (!cls) {
            showError('Selected class not found');
            return;
        }
        
        const studentId = 'student_' + Date.now();
        const studentName = `${firstName} ${lastName}`;
        
        data.students[studentId] = {
            id: studentId,
            name: studentName,
            firstName: firstName,
            lastName: lastName,
            classCode: classId,
            lastActive: null,
            device: getDeviceInfo(),
            connected: false,
            tabs: [],
            activeTab: 0
        };
        
        saveSharedData(data);
        
        // Clear form
        document.getElementById('awareStudentFirstName').value = '';
        document.getElementById('awareStudentLastName').value = '';
        
        closeModal('addStudentModal');
        showSuccess(`Student ${studentName} added to ${cls.name}`);
        logActivity('student_add', `Student added`, `${studentName} was added to ${cls.name}`);
        
        updateStudents();
    }
    
    // Show create class modal
    function showCreateClassModal() {
        openModal('createClassModal');
    }
    
    // Create aware class
    function createAwareClass() {
        const className = document.getElementById('awareClassName').value;
        const subject = document.getElementById('awareClassSubject').value;
        const grade = document.getElementById('awareClassGrade').value;
        const blockedSites = document.getElementById('awareClassBlocks').value;
        const teacher = document.getElementById('awareClassTeacher').value;
        
        if (!className) {
            showError('Class name is required');
            return;
        }
        
        const data = getSharedData();
        const classId = 'class_' + Date.now();
        
        data.classes[classId] = {
            id: classId,
            name: className,
            subject: subject,
            grade: grade,
            teacher: teacher || (currentUser.role === 'teacher' ? currentUser.name : ''),
            blockedSites: blockedSites.split('\n').filter(site => site.trim()),
            active: true,
            created: Date.now()
        };
        
        saveSharedData(data);
        
        // Clear form
        document.getElementById('awareClassName').value = '';
        document.getElementById('awareClassSubject').value = '';
        document.getElementById('awareClassGrade').value = '';
        document.getElementById('awareClassBlocks').value = '';
        document.getElementById('awareClassTeacher').value = '';
        
        closeModal('createClassModal');
        showSuccess(`Class "${className}" created successfully`);
        logActivity('class_create', 'Class created', `Class "${className}" was created`);
        
        updateClassesGrid();
    }
    
    // Show create bypass code modal
    function showCreateBypassCodeModal() {
        // Check if user is teacher (restricted)
        if (currentUser.role === 'teacher') {
            alert('This feature is only available to School Administrators');
            return;
        }
        
        const data = getSharedData();
        
        // Populate class select
        const classSelect = document.getElementById('bypassClassSelect');
        classSelect.innerHTML = '<option value="">Select Class</option>';
        Object.values(data.classes || {}).forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.id;
            option.textContent = cls.name || cls.id;
            classSelect.appendChild(option);
        });
        
        // Populate student select
        const studentSelect = document.getElementById('bypassStudentSelect');
        studentSelect.innerHTML = '<option value="">Select Student</option>';
        Object.values(data.students || {}).forEach(student => {
            const option = document.createElement('option');
            option.value = student.id;
            option.textContent = student.name;
            studentSelect.appendChild(option);
        });
        
        // Set up event listeners for code type
        document.getElementById('bypassCodeFor').addEventListener('change', function() {
            const value = this.value;
            document.getElementById('bypassCodeClassSelect').style.display = value === 'class' ? 'block' : 'none';
            document.getElementById('bypassCodeStudentSelect').style.display = value === 'student' ? 'block' : 'none';
        });
        
        openModal('createBypassCodeModal');
    }
    
    // Create bypass code
    function createBypassCode() {
        const type = document.getElementById('bypassCodeType').value;
        const forType = document.getElementById('bypassCodeFor').value;
        const classId = document.getElementById('bypassClassSelect').value;
        const studentId = document.getElementById('bypassStudentSelect').value;
        const expiry = document.getElementById('bypassExpiry').value;
        const usageLimit = parseInt(document.getElementById('bypassUsageLimit').value) || 0;
        const notes = document.getElementById('bypassNotes').value;
        
        // Generate code
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let code = '';
        for (let i = 0; i < 8; i++) {
            code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        code = code.match(/.{1,4}/g).join('-');
        
        // Calculate expiry date
        let expiryDate = null;
        if (expiry !== 'never') {
            const now = new Date();
            if (expiry === '1h') now.setHours(now.getHours() + 1);
            else if (expiry === '4h') now.setHours(now.getHours() + 4);
            else if (expiry === '24h') now.setDate(now.getDate() + 1);
            else if (expiry === '7d') now.setDate(now.getDate() + 7);
            else if (expiry === '30d') now.setDate(now.getDate() + 30);
            expiryDate = now.getTime();
        }
        
        const data = getSharedData();
        const bypassId = 'bypass_' + Date.now();
        
        data.bypassCodes[bypassId] = {
            id: bypassId,
            code: code,
            type: type,
            forType: forType,
            classId: classId || null,
            studentId: studentId || null,
            expiry: expiryDate,
            maxUsage: usageLimit,
            usageCount: 0,
            active: true,
            notes: notes,
            created: Date.now(),
            createdBy: currentUser.id
        };
        
        saveSharedData(data);
        
        closeModal('createBypassCodeModal');
        showSuccess(`Bypass code created: ${code}`);
        logActivity('bypass_create', 'Bypass code created', `Created ${type} bypass code: ${code}`);
        
        updateBypassCodesGrid();
    }
    
    // Show create schedule modal
    function showCreateScheduleModal() {
        // Check if user is teacher (restricted)
        if (currentUser.role === 'teacher') {
            alert('This feature is only available to School Administrators');
            return;
        }
        
        const data = getSharedData();
        const classSelect = document.getElementById('scheduleClassSelect');
        classSelect.innerHTML = '<option value="">Select Class</option>';
        
        Object.values(data.classes || {}).forEach(cls => {
            const option = document.createElement('option');
            option.value = cls.id;
            option.textContent = cls.name || cls.id;
            classSelect.appendChild(option);
        });
        
        // Set default dates
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('scheduleStartDate').value = today;
        
        // Clear selected days
        selectedDays = [];
        document.querySelectorAll('.day-option').forEach(day => {
            day.classList.remove('selected');
        });
        
        openModal('createScheduleModal');
    }
    
    // Toggle day selection
    function toggleDaySelection(element) {
        const day = element.getAttribute('data-day');
        const index = selectedDays.indexOf(day);
        
        if (index === -1) {
            selectedDays.push(day);
            element.classList.add('selected');
        } else {
            selectedDays.splice(index, 1);
            element.classList.remove('selected');
        }
        
        document.getElementById('scheduleDays').value = selectedDays.join(',');
    }
    
    // Create class schedule
    function createClassSchedule() {
        const classId = document.getElementById('scheduleClassSelect').value;
        const startTime = document.getElementById('scheduleStartTime').value;
        const endTime = document.getElementById('scheduleEndTime').value;
        const type = document.getElementById('scheduleType').value;
        const startDate = document.getElementById('scheduleStartDate').value;
        const endDate = document.getElementById('scheduleEndDate').value;
        const active = document.getElementById('scheduleActive').checked;
        
        if (!classId || !startTime || !endTime || selectedDays.length === 0) {
            showError('Please fill in all required fields');
            return;
        }
        
        const data = getSharedData();
        const scheduleId = 'schedule_' + Date.now();
        
        data.schedules[scheduleId] = {
            id: scheduleId,
            classId: classId,
            days: selectedDays,
            startTime: startTime,
            endTime: endTime,
            type: type,
            startDate: startDate ? new Date(startDate).getTime() : null,
            endDate: endDate ? new Date(endDate).getTime() : null,
            active: active,
            created: Date.now(),
            createdBy: currentUser.id
        };
        
        saveSharedData(data);
        
        closeModal('createScheduleModal');
        showSuccess('Class schedule created successfully');
        logActivity('schedule_create', 'Schedule created', 'Created a new class schedule');
        
        updateSchedulesGrid();
    }
    
    // Save school settings
    function saveSchoolSettings() {
        const globalBlocks = document.getElementById('globalBlocks').value.split('\n').filter(site => site.trim());
        const monitoringStart = document.getElementById('monitoringStart').value;
        const monitoringEnd = document.getElementById('monitoringEnd').value;
        const enableScreenshots = document.getElementById('enableScreenshots').checked;
        const enableActivityLogging = document.getElementById('enableActivityLogging').checked;
        const enableMessaging = document.getElementById('enableMessaging').checked;
        const requireParentApproval = document.getElementById('requireParentApproval').checked;
        
        const data = getSharedData();
        
        data.awareSettings = {
            globalBlocks: globalBlocks,
            monitoringHours: { start: monitoringStart, end: monitoringEnd },
            enableScreenshots: enableScreenshots,
            enableActivityLogging: enableActivityLogging,
            enableMessaging: enableMessaging,
            requireParentApproval: requireParentApproval
        };
        
        saveSharedData(data);
        showSuccess('Settings saved successfully');
        logActivity('settings_save', 'Settings updated', 'Monitoring settings were updated');
    }
    
    // Show student detail
    function showStudentDetail(studentId) {
        const data = getSharedData();
        const student = data.students[studentId];
        
        if (!student) {
            showError('Student not found');
            return;
        }
        
        selectedStudent = studentId;
        
        const cls = data.classes && data.classes[student.classCode];
        document.getElementById('studentDetailName').textContent = student.name;
        document.getElementById('studentDetailClass').textContent = `Class: ${cls ? cls.name : 'Unknown'}`;
        document.getElementById('studentDetailAvatar').textContent = student.name ? student.name.charAt(0).toUpperCase() : 'S';
        
        const isActive = student.lastActive && (Date.now() - student.lastActive) < 30000;
        const isLocked = data.studentLocks && data.studentLocks[studentId];
        
        // Get current tab info
        const currentTab = student.tabs && student.tabs[student.activeTab || 0];
        const activity = currentTab ? currentTab.title || currentTab.url : 'No activity';
        
        document.getElementById('studentCurrentActivity').textContent = activity;
        document.getElementById('studentCurrentStatus').textContent = isLocked ? 'Locked' : (isActive ? 'Online' : 'Offline');
        
        // Update activity list
        const activities = (data.activityLogs && data.activityLogs[studentId]) || [];
        const activityList = document.getElementById('studentActivityList');
        activityList.innerHTML = '';
        
        activities.slice(-5).reverse().forEach(activity => {
            const div = document.createElement('div');
            div.style.padding = '8px';
            div.style.borderBottom = '1px solid #eee';
            div.innerHTML = `
                <div style="font-weight: 500;">${activity.action || 'Activity'}</div>
                <div style="font-size: 0.8rem; color: #666;">${formatTime(activity.timestamp)}</div>
            `;
            activityList.appendChild(div);
        });
        
        openModal('studentDetailModal');
    }
    
    // Send student message
    function sendStudentMessage() {
        if (!selectedStudent) return;
        
        const message = prompt('Enter message to send to student:');
        if (message) {
            const data = getSharedData();
            
            if (!data.messages) data.messages = {};
            if (!data.messages[selectedStudent]) data.messages[selectedStudent] = [];
            
            data.messages[selectedStudent].push({
                text: message,
                from: currentUser.name || currentUser.adminName,
                timestamp: Date.now()
            });
            
            saveSharedData(data);
            showSuccess('Message sent to student');
            logActivity('message_sent', 'Message sent', `Sent message to student: ${message}`, selectedStudent);
        }
    }
    
    // Lock student browser
    function lockStudent(studentId) {
        const id = studentId || selectedStudent;
        if (!id) return;
        
        const data = getSharedData();
        
        if (!data.studentLocks) data.studentLocks = {};
        data.studentLocks[id] = true;
        
        saveSharedData(data);
        
        showSuccess(`Browser locked for student`);
        logActivity('lock_student', 'Browser locked', `Locked browser for student`, id);
        
        updateAwareDashboard();
    }
    
    // Unlock student browser
    function unlockStudent(studentId) {
        const id = studentId || selectedStudent;
        if (!id) return;
        
        const data = getSharedData();
        
        if (data.studentLocks) {
            delete data.studentLocks[id];
        }
        
        saveSharedData(data);
        
        showSuccess(`Browser unlocked for student`);
        logActivity('unlock_student', 'Browser unlocked', `Unlocked browser for student`, id);
        
        updateAwareDashboard();
    }
    
    // Request screenshot
    function requestScreenshot(studentId) {
        const id = studentId || selectedStudent;
        if (!id) return;
        
        const data = getSharedData();
        
        if (!data.screenshots) data.screenshots = {};
        data.screenshots[id] = {
            requested: true,
            timestamp: Date.now()
        };
        
        saveSharedData(data);
        
        showSuccess(`Screenshot requested from student`);
        logActivity('screenshot_request', 'Screenshot requested', `Requested screenshot from student`, id);
        
        // Simulate delay
        setTimeout(() => {
            showSuccess(`Screenshot received from student`);
        }, 1500);
    }
    
    // Filter activity
    function filterActivity() {
        const filter = document.getElementById('activityFilter').value;
        // This would filter the activity view if implemented
        updateActivity();
    }
    
    // Export activity
    function exportActivity() {
        const data = getSharedData();
        const activities = getAllActivities(data).sort((a, b) => b.timestamp - a.timestamp);
        
        let csv = 'Timestamp,Action,Student,Class\n';
        activities.forEach(activity => {
            csv += `${formatTime(activity.timestamp)},${activity.action || ''},${getStudentNameById(activity.studentId) || ''},${getClassName(activity.classCode) || ''}\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `activity_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showSuccess('Activity data exported successfully');
    }
    
    // View class details
    function viewClassDetails(classId) {
        const data = getSharedData();
        const cls = data.classes && data.classes[classId];
        
        if (cls) {
            const students = Object.values(data.students || {}).filter(s => s.classCode === classId);
            alert(`Class: ${cls.name}\nSubject: ${cls.subject || 'None'}\nGrade: ${cls.grade || 'None'}\nTeacher: ${cls.teacher || 'None'}\nStudents: ${students.length}\nBlocked Sites: ${cls.blockedSites ? cls.blockedSites.length : 0}`);
        }
    }
    
    // Edit class
    function editClass(classId) {
        const data = getSharedData();
        const cls = data.classes && data.classes[classId];
        
        if (cls) {
            const newName = prompt('Enter new class name:', cls.name);
            if (newName) {
                cls.name = newName;
                saveSharedData(data);
                showSuccess('Class updated successfully');
                updateClassesGrid();
            }
        }
    }
    
    // Delete class
    function deleteClass(classId) {
        if (!confirm('Are you sure you want to delete this class? This will remove all associated students and schedules.')) {
            return;
        }
        
        const data = getSharedData();
        const cls = data.classes && data.classes[classId];
        
        if (cls) {
            // Remove class
            delete data.classes[classId];
            
            // Remove students from this class
            Object.keys(data.students || {}).forEach(studentId => {
                if (data.students[studentId].classCode === classId) {
                    delete data.students[studentId];
                }
            });
            
            // Remove schedules for this class
            Object.keys(data.schedules || {}).forEach(scheduleId => {
                if (data.schedules[scheduleId].classId === classId) {
                    delete data.schedules[scheduleId];
                }
            });
            
            saveSharedData(data);
            showSuccess('Class deleted successfully');
            logActivity('class_delete', 'Class deleted', `Deleted class: ${cls.name}`);
            updateClassesGrid();
        }
    }
    
    // View schedule details
    function viewScheduleDetails(scheduleId) {
        const data = getSharedData();
        const schedule = data.schedules && data.schedules[scheduleId];
        
        if (schedule) {
            const cls = data.classes && data.classes[schedule.classId];
            const daysMap = { mon: 'Monday', tue: 'Tuesday', wed: 'Wednesday', thu: 'Thursday', fri: 'Friday', sat: 'Saturday', sun: 'Sunday' };
            const days = schedule.days ? schedule.days.map(day => daysMap[day] || day).join(', ') : 'No days';
            
            let details = `
                <h3>${cls ? cls.name : schedule.classId}</h3>
                <p><strong>Days:</strong> ${days}</p>
                <p><strong>Time:</strong> ${schedule.startTime} - ${schedule.endTime}</p>
                <p><strong>Type:</strong> ${schedule.type || 'monitoring'}</p>
                <p><strong>Status:</strong> ${schedule.active === false ? 'Inactive' : 'Active'}</p>
            `;
            
            if (schedule.startDate) {
                details += `<p><strong>Starts:</strong> ${formatDate(schedule.startDate)}</p>`;
            }
            
            if (schedule.endDate) {
                details += `<p><strong>Ends:</strong> ${formatDate(schedule.endDate)}</p>`;
            }
            
            document.getElementById('scheduleDetails').innerHTML = details;
            openModal('viewScheduleModal');
        }
    }
    
    // Edit schedule
    function editSchedule(scheduleId) {
        // Implementation for editing schedule
        alert('Edit schedule functionality would be implemented here');
    }
    
    // Delete schedule
    function deleteSchedule(scheduleId) {
        if (!confirm('Are you sure you want to delete this schedule?')) {
            return;
        }
        
        const data = getSharedData();
        const schedule = data.schedules && data.schedules[scheduleId];
        
        if (schedule) {
            delete data.schedules[scheduleId];
            saveSharedData(data);
            showSuccess('Schedule deleted successfully');
            updateSchedulesGrid();
        }
    }
    
    // Copy bypass code
    function copyBypassCode(code) {
        navigator.clipboard.writeText(code).then(() => {
            showSuccess('Code copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy: ', err);
        });
    }
    
    // Revoke bypass code
    function revokeBypassCode(codeId) {
        if (!confirm('Are you sure you want to revoke this bypass code?')) {
            return;
        }
        
        const data = getSharedData();
        const code = data.bypassCodes && data.bypassCodes[codeId];
        
        if (code) {
            code.active = false;
            saveSharedData(data);
            showSuccess('Bypass code revoked');
            updateBypassCodesGrid();
        }
    }
    
    // Edit student
    function editStudent(studentId) {
        const data = getSharedData();
        const student = data.students && data.students[studentId];
        
        if (student) {
            const newName = prompt('Enter new student name:', student.name);
            if (newName) {
                student.name = newName;
                saveSharedData(data);
                showSuccess('Student updated successfully');
                updateStudents();
            }
        }
    }
    
    // Delete student
    function deleteStudent(studentId) {
        if (!confirm('Are you sure you want to remove this student?')) {
            return;
        }
        
        const data = getSharedData();
        const student = data.students && data.students[studentId];
        
        if (student) {
            delete data.students[studentId];
            saveSharedData(data);
            showSuccess('Student removed successfully');
            logActivity('student_remove', 'Student removed', `Removed student: ${student.name}`);
            updateStudents();
        }
    }
    
    // Open modal
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }
    
    // Close modal
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    // Open ClassStacks Dashboard (main dashboard)
    function openClassStacksDashboard() {
        // Both teachers and school admins can access the main dashboard
        window.open('classstacks.html', '_blank');
    }
    
    // Log activity
    function logActivity(action, title, description, studentId = null) {
        const data = getSharedData();
        
        if (!data.activityLogs) data.activityLogs = {};
        
        // If studentId provided, add to student's logs
        if (studentId) {
            if (!data.activityLogs[studentId]) data.activityLogs[studentId] = [];
            data.activityLogs[studentId].push({
                action: action,
                timestamp: Date.now(),
                description: description
            });
        }
        
        // Also log in aware activity
        if (!data.awareLogs) data.awareLogs = [];
        data.awareLogs.push({
            action: action,
            title: title,
            description: description,
            timestamp: Date.now(),
            userId: currentUser.id,
            userName: currentUser.name || currentUser.adminName
        });
        
        saveSharedData(data);
    }
    
    // Format time
    function formatTime(timestamp) {
        if (!timestamp) return 'Never';
        const date = new Date(timestamp);
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // Format date
    function formatDate(timestamp) {
        if (!timestamp) return 'Never';
        const date = new Date(timestamp);
        return date.toLocaleDateString();
    }
    
    // Get device info
    function getDeviceInfo() {
        const ua = navigator.userAgent;
        if (/Mobile|Android|iPhone|iPad|iPod/.test(ua)) return 'Mobile';
        else if (/Tablet|iPad/.test(ua)) return 'Tablet';
        else return 'Desktop';
    }
    
    // Logout function
    function logout() {
        clearInterval(monitoringInterval);
        currentUser = null;
        localStorage.removeItem('currentUser');
        
        // Show login page
        document.getElementById('awareDashboard').style.display = 'none';
        document.getElementById('authContainer').style.display = 'flex';
        
        // Clear form fields
        document.getElementById('schoolEmail').value = '';
        document.getElementById('schoolPassword').value = '';
        document.getElementById('teacherEmail').value = '';
        document.getElementById('teacherPassword').value = '';
        
        // Show success message
        showSuccess('Logged out successfully!');
    }
    
    // Initialize the application when the page loads
    document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>
